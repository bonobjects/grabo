<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>ICON COMPOSER</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    /* CSSをここに統合しました */
    * { box-sizing: border-box; }
    body {
      margin: 0;
      background: #0b1418; /* 背景色 */
      font-family: 'Arial', sans-serif;
      color: #6fffe9;
      display: flex;
      justify-content: center;
      padding: 20px;
    }
    .app {
      display: flex;
      flex-direction: column;
      align-items: center;
      width: 100%;
      max-width: 400px;
    }
    .canvas-wrap {
      width: 100%;
      aspect-ratio: 1 / 1;
      border: 3px solid #2dd4bf;
      margin-bottom: 20px;
      background: #000;
      box-shadow: 0 0 15px rgba(45, 212, 191, 0.3);
    }
    canvas {
      width: 100%;
      height: auto;
      display: block;
    }
    .controls {
      width: 100%;
      display: flex;
      flex-direction: column;
      gap: 10px;
      transition: all 0.5s ease;
    }
    /* ボーナス演出 */
    .controls.bonus-mode {
      animation: neon-glow 1.5s infinite alternate;
      border: 2px solid #fff;
      padding: 15px;
      background: rgba(45, 212, 191, 0.1);
    }
    @keyframes neon-glow {
      from { box-shadow: 0 0 10px #2dd4bf; border-color: #2dd4bf; }
      to { box-shadow: 0 0 30px #ff00ff; border-color: #ff00ff; }
    }
    .swipe {
      border: 1px solid #2dd4bf;
      padding: 15px;
      text-align: center;
      letter-spacing: 2px;
      cursor: pointer;
      font-weight: bold;
      transition: 0.2s;
    }
    .swipe:hover { background: rgba(45, 212, 191, 0.1); }
    .swipe:active { background: rgba(45, 212, 191, 0.3); }
    .buttons {
      display: flex;
      gap: 10px;
      margin-top: 10px;
    }
    button {
      flex: 1;
      background: #2dd4bf;
      color: #002b2b;
      border: none;
      padding: 15px;
      font-size: 14px;
      font-weight: bold;
      cursor: pointer;
    }
    button:active { opacity: 0.7; }
    #downloadBtn { background: #6fffe9; }
  </style>
</head>
<body>

<div class="app">
  <div class="canvas-wrap">
    <canvas id="canvas" width="512" height="512"></canvas>
  </div>

  <div class="controls" id="controls">
    <div class="swipe" data-part="background">BACKGROUND</div>
    <div class="swipe" data-part="body">BODY</div>
    <div class="swipe" data-part="head">HEAD</div>
    <div class="swipe" data-part="face">FACE</div>
    <div class="swipe" data-part="accessory">ACCESSORY</div>

    <div class="buttons">
      <button id="randomBtn">RANDOM (<span id="count">0</span>/5)</button>
      <button id="downloadBtn">DOWNLOAD</button>
    </div>
  </div>
</div>

<script>
  // JavaScriptをここに統合しました
  const canvas = document.getElementById("canvas");
  const ctx = canvas.getContext("2d");

  // お手持ちの画像枚数に合わせてここを書き換えてください
  const parts = {
    background: 3, 
    body: 2,
    head: 2,
    face: 2,
    accessory: 3
  };

  const order = ["background", "body", "head", "face", "accessory"];
  const state = { background: 0, body: 0, head: 0, face: 0, accessory: 0 };
  let randomCount = 0;

  async function draw() {
    ctx.clearRect(0, 0, 512, 512);

    for (const part of order) {
      const img = new Image();
      // パスを ./images/ に固定
      img.src = `./images/${part}${state[part]}.png`;

      await new Promise(resolve => {
        img.onload = () => {
          ctx.drawImage(img, 0, 0, 512, 512);
          resolve();
        };
        img.onerror = () => {
          // 画像がない場合はスキップしてエラーを出さない
          resolve();
        };
      });
    }
  }

  // 初期描画
  draw();

  // クリックイベント
  document.querySelectorAll(".swipe").forEach(el => {
    el.addEventListener("click", () => {
      const part = el.dataset.part;
      state[part] = (state[part] + 1) % parts[part];
      draw();
    });
  });

  // ランダムボタン
  document.getElementById("randomBtn").addEventListener("click", () => {
    randomCount++;
    document.getElementById("count").innerText = randomCount;

    Object.keys(parts).forEach(part => {
      state[part] = Math.floor(Math.random() * parts[part]);
    });
    draw();

    if (randomCount >= 5) {
      document.getElementById("controls").classList.add("bonus-mode");
    }
  });

  // ダウンロード
  document.getElementById("downloadBtn").addEventListener("click", () => {
    const link = document.createElement("a");
    link.download = "icon.png";
    link.href = canvas.toDataURL("image/png");
    link.click();
  });
</script>

</body>
</html>
